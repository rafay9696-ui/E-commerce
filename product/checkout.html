<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Stitch House</title>
    <link rel="stylesheet" href="variables.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="checkout.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600;700&family=Dancing+Script:wght@600;700&display=swap" rel="stylesheet">
    <style>
        .alert { padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .alert-danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }

        /* My Order Link Styles */
        .myorder-link {
            position: relative;
            margin-right: 15px;
        }
        .myorder-link a {
            color: var(--text-color, #333);
            font-size: 20px;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .myorder-link a:hover { color: var(--gold-color, #d4af37); }
        .myorder-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #d4af37;
            color: white;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Side Navigation -->
    <div class="side-nav">
        <div class="side-nav-content">
            <div class="side-nav-header">
                <div class="logo-container">
                    <h2 class="logo-text">Stitch House</h2>
                </div>
                <button class="close-sidenav">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="side-nav-links">
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i>Home</a></li>
                    <li><a href="order.html"><i class="fas fa-shopping-bag"></i>Shop Now</a></li>
                    <li><a href="myorder.html"><i class="fas fa-shopping-cart"></i>My Order</a></li>
                    <li><a href="contact.html"><i class="fas fa-envelope"></i>Contact Us</a></li>
                </ul>
            </div>
            <div class="side-nav-footer">
                <div class="social-icons">
                    <a href="#" class="facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="pinterest"><i class="fab fa-pinterest"></i></a>
                    <a href="#" class="youtube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
    </div>
    <div class="side-nav-backdrop"></div>

    <header>
        <div class="container">
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <div class="site-title">
                <a href="index.html">
                    <h1 class="logo-text">Stitch House</h1>
                </a>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="order.html" class="nav-link">Shop Now</a></li>
                    <li><a href="myorder.html" class="nav-link">My Order</a></li>
                    <li><a href="contact.html" class="nav-link">Contact Us</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <div class="login-link" id="login-link">
                    <a href="login.html">
                        <i class="fas fa-user"></i>
                    </a>
                </div>
                <div class="myorder-link">
                    <a href="myorder.html" title="My Order">
                        <i class="fas fa-cut"></i>
                        <span class="myorder-count">0</span>
                    </a>
                </div>
                <div class="cart-link">
                    <a href="cart.html" title="Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </a>
                </div>
                <div class="user-info" id="user-info" style="display: none;">
                    <span class="user-name"></span>
                    <a href="#" class="logout-link" onclick="handleLogout(); return false;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Page Banner -->
    <section class="page-banner">
        <div class="container">
            <h1>Checkout</h1>
            <div class="breadcrumb">
                <a href="index.html">Home</a> / <a href="cart.html">Cart</a> / <span>Checkout</span>
            </div>
        </div>
    </section>

    <!-- Checkout Section -->
    <section class="checkout-section">
        <div class="container">
            <div id="alert-container"></div>

            <!-- Empty cart message -->
            <div class="empty-cart-message" id="empty-cart" style="display: none;">
                <i class="fas fa-shopping-cart"></i>
                <h2>Your cart is empty</h2>
                <p>Browse our collection and add some fabrics to your cart</p>
                <a href="order.html" class="btn-primary">Shop Now</a>
            </div>

            <!-- Checkout content -->
            <div class="checkout-container" id="checkout-content">
                <div class="checkout-form">
                    <h2>Shipping Information</h2>
                    <form id="checkout-form">
                        <div class="form-group">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="address">Address</label>
                            <textarea id="address" name="address" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" name="city" required>
                        </div>

                        <h2>Payment Method</h2>
                        <div class="payment-methods">
                            <div class="payment-method">
                                <input type="radio" id="cash_on_delivery" name="payment_method" value="cash_on_delivery" checked>
                                <label for="cash_on_delivery">
                                    <i class="fas fa-money-bill-wave"></i> Cash on Delivery
                                </label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="bank_transfer" name="payment_method" value="bank_transfer">
                                <label for="bank_transfer">
                                    <i class="fas fa-university"></i> Bank Transfer
                                </label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="credit_card" name="payment_method" value="credit_card">
                                <label for="credit_card">
                                    <i class="fas fa-credit-card"></i> Credit Card
                                </label>
                            </div>
                        </div>

                        <div class="form-group terms-checkbox">
                            <input type="checkbox" id="terms" name="terms" required>
                            <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                        </div>

                        <button type="submit" class="btn-primary">Place Order</button>
                    </form>
                </div>

                <div class="order-summary">
                    <h2>Order Summary</h2>
                    <div class="cart-items" id="order-items">
                        <!-- Items will be populated dynamically -->
                    </div>

                    <div class="summary-totals">
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="subtotal">PKR 0</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping</span>
                            <span>PKR 200</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span id="total">PKR 0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Order Confirmation Modal -->
    <div class="modal" id="confirmation-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-check-circle" style="color: #28a745; font-size: 60px;"></i>
            </div>
            <div class="modal-body">
                <h2>Order Placed Successfully!</h2>
                <p>Thank you for your order. Your order number is: <strong id="order-number">#12345</strong></p>
                <p>We will send you a confirmation email shortly.</p>
            </div>
            <div class="modal-footer">
                <a href="index.html" class="btn-primary">Continue Shopping</a>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section about">
                    <div class="footer-logo">
                        <a href="index.html" class="logo-button">
                            <h3 class="logo-text">Stitch House</h3>
                        </a>
                    </div>
                    <p>Your premium destination for high-quality fabrics and exceptional service.</p>
                    <div class="social-icons">
                        <a href="#" class="facebook"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="pinterest"><i class="fab fa-pinterest"></i></a>
                        <a href="#" class="youtube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-section links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="order.html">Shop Now</a></li>
                        <li><a href="myorder.html">My Order</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section contact">
                    <h3>Contact Info</h3>
                    <p><i class="fas fa-map-marker-alt"></i> Main Gulberg, Lahore, Pakistan</p>
                    <p><i class="fas fa-phone"></i> 0304-2292813</p>
                    <p><i class="fas fa-envelope"></i> info@stitchhouse.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Stitch House. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <div class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load cart from localStorage
        const cart = JSON.parse(localStorage.getItem('finalCart')) || JSON.parse(localStorage.getItem('shoppingCart')) || [];
        const emptyCart = document.getElementById('empty-cart');
        const checkoutContent = document.getElementById('checkout-content');
        const orderItems = document.getElementById('order-items');
        const subtotalEl = document.getElementById('subtotal');
        const totalEl = document.getElementById('total');

        // Update cart count
        updateCartCount();

        // Check login status
        checkLoginStatus();

        // Display order items
        if (cart.length === 0) {
            emptyCart.style.display = 'flex';
            checkoutContent.style.display = 'none';
        } else {
            emptyCart.style.display = 'none';
            checkoutContent.style.display = 'flex';
            displayOrderItems();
        }

        function displayOrderItems() {
            orderItems.innerHTML = '';
            let subtotal = 0;

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;

                const itemEl = document.createElement('div');
                itemEl.className = 'summary-item';
                itemEl.innerHTML = `
                    <div class="item-image">
                        <img src="images/${item.image}" alt="${item.name}" onerror="this.src='images/placeholder.jpg'">
                    </div>
                    <div class="item-details">
                        <h3>${item.name}</h3>
                        <p class="item-price">PKR ${item.price.toLocaleString()} x ${item.quantity}</p>
                        ${item.design ? `<p class="design-info">${item.design}</p>` : ''}
                    </div>
                    <div class="item-total">
                        PKR ${itemTotal.toLocaleString()}
                    </div>
                `;
                orderItems.appendChild(itemEl);
            });

            const shipping = 200;
            const total = subtotal + shipping;

            subtotalEl.textContent = `PKR ${subtotal.toLocaleString()}`;
            totalEl.textContent = `PKR ${total.toLocaleString()}`;
        }

        // Fill form with saved user data
        const savedName = localStorage.getItem('userName');
        const savedEmail = localStorage.getItem('userEmail');
        const savedPhone = localStorage.getItem('userPhone');

        if (savedName) document.getElementById('name').value = savedName;
        if (savedEmail) document.getElementById('email').value = savedEmail;
        if (savedPhone) document.getElementById('phone').value = savedPhone;

        // Form submission
        document.getElementById('checkout-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const paymentMethod = document.querySelector('input[name="payment_method"]:checked').value;
            const terms = document.getElementById('terms').checked;

            if (!name || !email || !phone || !address || !city) {
                showAlert('Please fill in all required fields.', 'danger');
                return;
            }

            if (!terms) {
                showAlert('You must agree to the Terms of Service and Privacy Policy.', 'danger');
                return;
            }

            // Generate order number
            const orderNumber = 'SH' + Date.now().toString().slice(-8);

            // Save order to localStorage for demo
            const order = {
                orderNumber: orderNumber,
                name: name,
                email: email,
                phone: phone,
                address: address,
                city: city,
                paymentMethod: paymentMethod,
                items: cart,
                date: new Date().toISOString()
            };

            // Get existing orders or create new array
            let orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.push(order);
            localStorage.setItem('orders', JSON.stringify(orders));

            // Clear cart
            localStorage.removeItem('shoppingCart');
            localStorage.removeItem('finalCart');

            // Show confirmation
            document.getElementById('order-number').textContent = '#' + orderNumber;
            document.getElementById('confirmation-modal').style.display = 'flex';
        });

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => alertContainer.innerHTML = '', 5000);
        }

        // Side navigation functionality
        const sideNavToggle = document.querySelector('.menu-toggle');
        const sideNav = document.querySelector('.side-nav');
        const sideNavBackdrop = document.querySelector('.side-nav-backdrop');
        const sideNavClose = document.querySelector('.close-sidenav');

        if (sideNavToggle && sideNav) {
            sideNavToggle.addEventListener('click', () => {
                sideNav.classList.add('open');
                sideNavBackdrop.classList.add('active');
                document.body.classList.add('no-scroll');
            });
        }

        function closeSideNav() {
            if (sideNav) {
                sideNav.classList.remove('open');
                sideNavBackdrop.classList.remove('active');
                document.body.classList.remove('no-scroll');
            }
        }

        if (sideNavClose) sideNavClose.addEventListener('click', closeSideNav);
        if (sideNavBackdrop) sideNavBackdrop.addEventListener('click', closeSideNav);

        // Back to top button
        const backToTopBtn = document.querySelector('.back-to-top');

        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    });

    function updateCartCount() {
        const cartCountEl = document.querySelector('.cart-count');
        const myorderCountEl = document.querySelector('.myorder-count');
        const shoppingCart = JSON.parse(localStorage.getItem('shoppingCart')) || [];
        const finalCart = JSON.parse(localStorage.getItem('finalCart')) || [];

        // My Order count - items waiting for customization
        let myOrderTotal = 0;
        shoppingCart.forEach(item => myOrderTotal += item.quantity || 1);
        if (myorderCountEl) myorderCountEl.textContent = myOrderTotal;

        // Cart count - only customized items ready for checkout
        let cartTotal = 0;
        finalCart.forEach(item => cartTotal += item.quantity || 1);
        if (cartCountEl) cartCountEl.textContent = cartTotal;
    }

    function checkLoginStatus() {
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        const userName = localStorage.getItem('userName');
        const loginLink = document.getElementById('login-link');
        const userInfo = document.getElementById('user-info');

        if (isLoggedIn && userName) {
            if (loginLink) loginLink.style.display = 'none';
            if (userInfo) {
                userInfo.style.display = 'flex';
                userInfo.querySelector('.user-name').textContent = userName;
            }
        } else {
            if (loginLink) loginLink.style.display = 'block';
            if (userInfo) userInfo.style.display = 'none';
        }
    }

    function handleLogout() {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('userName');
        localStorage.removeItem('userEmail');
        localStorage.removeItem('userPhone');
        window.location.reload();
    }
    </script>

    <style>
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }
    .modal-content {
        background: white;
        padding: 40px;
        border-radius: 10px;
        text-align: center;
        max-width: 500px;
        width: 90%;
    }
    .modal-header {
        margin-bottom: 20px;
    }
    .modal-body h2 {
        margin-bottom: 15px;
        color: #333;
    }
    .modal-body p {
        margin-bottom: 10px;
        color: #666;
    }
    .modal-footer {
        margin-top: 30px;
    }
    </style>
</body>
</html>
