<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Order - Stitch House</title>
    <link rel="stylesheet" href="variables.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="order.css">
    <link rel="stylesheet" href="myorder.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600;700&family=Dancing+Script:wght@600;700&display=swap" rel="stylesheet">
    <style>
        /* My Order Link Styles */
        .myorder-link {
            position: relative;
            margin-right: 15px;
        }
        .myorder-link a {
            color: var(--text-color, #333);
            font-size: 20px;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .myorder-link a:hover { color: var(--gold-color, #d4af37); }
        .myorder-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #d4af37;
            color: white;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .customize-item-btn, .measurement-btn, .add-to-cart-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 12px;
            background-color: #d4af37;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 8px;
            transition: all 0.3s ease;
            gap: 5px;
        }
        .customize-item-btn { background-color: #d4af37; }
        .measurement-btn { margin-left: 10px; background-color: #333; }
        .customize-item-btn:hover, .measurement-btn:hover, .add-to-cart-btn:hover {
            opacity: 0.85;
            transform: translateY(-2px);
        }
        .add-to-cart-btn { margin-top: 10px; width: 100%; background-color: #28a745; }
        .add-to-cart-btn.disabled { background-color: #ccc; cursor: not-allowed; }
        .design-btn-group { display: flex; align-items: center; margin-top: 8px; flex-wrap: wrap; gap: 5px; }
        .cart-item-total { display: flex; flex-direction: column; align-items: flex-end; }

        /* Design Panel Styles */
        .item-design-options {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .design-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .design-header h4 { margin: 0; color: #333; }
        .close-design-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #999;
        }
        .close-design-btn:hover { color: #333; }
        .design-section { margin-bottom: 15px; }
        .design-section h5 { margin: 0 0 10px 0; color: #555; font-size: 14px; }
        .design-options { display: flex; flex-wrap: wrap; gap: 10px; }
        .design-option {
            flex: 1;
            min-width: 120px;
        }
        .design-option input[type="radio"] { display: none; }
        .design-option label {
            display: block;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }
        .design-option input[type="radio"]:checked + label {
            border-color: #d4af37;
            background-color: #fdf8e8;
            color: #b8941f;
        }
        .btn-confirm-design {
            width: 100%;
            padding: 12px;
            background: #d4af37;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
        }
        .btn-confirm-design:hover { background: #b8941f; }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            max-width: 600px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalFadeIn 0.3s;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            background: none;
            border: none;
        }
        .close-modal:hover { color: #333; }
        .modal h3 {
            margin: 0 0 20px 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .measurement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .measurement-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }
        .measurement-field input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .measurement-field small {
            color: #666;
            font-size: 11px;
        }
        .btn-save-measurements {
            width: 100%;
            padding: 12px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 20px;
        }
        .btn-save-measurements:hover { background: #218838; }

        /* Measurements Display */
        .measurements-display {
            background: #e8f5e9;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
        }
        .measurements-display h5 {
            margin: 0 0 8px 0;
            color: #28a745;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .measurements-display table { width: 100%; }
        .measurements-display td { padding: 2px 5px; }

        /* User Dropdown Styles */
        .user-dropdown { position: relative; display: inline-block; }
        .user-dropdown-btn {
            display: flex; align-items: center; gap: 8px;
            background: none; border: none; cursor: pointer;
            padding: 8px 12px; color: #333; font-size: 14px;
            border-radius: 25px; transition: all 0.3s ease;
        }
        .user-dropdown-btn:hover { background-color: rgba(212, 175, 55, 0.1); }
        .user-dropdown-btn .fa-user-circle { font-size: 22px; color: #d4af37; }
        .user-dropdown-btn .dropdown-arrow { font-size: 10px; transition: transform 0.3s; }
        .user-dropdown.active .dropdown-arrow { transform: rotate(180deg); }
        .user-dropdown-content {
            display: none; position: absolute; right: 0; top: calc(100% + 5px);
            background: white; min-width: 200px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border-radius: 10px; z-index: 1000; overflow: hidden; border: 1px solid #eee;
        }
        .user-dropdown.active .user-dropdown-content { display: block; animation: dropdownFade 0.2s ease; }
        @keyframes dropdownFade {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .user-dropdown-content a {
            display: flex; align-items: center; gap: 12px;
            padding: 14px 18px; color: #333; text-decoration: none;
            transition: all 0.2s; font-size: 14px;
        }
        .user-dropdown-content a:hover { background: linear-gradient(90deg, rgba(212,175,55,0.1), transparent); color: #d4af37; }
        .user-dropdown-content a i { width: 20px; color: #d4af37; }
        .user-dropdown-content a:first-child { border-bottom: 1px solid #eee; }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>

    <!-- MediaPipe Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

    <!-- Custom MediaPipe Files -->
    <link rel="stylesheet" href="mediapipe-pose/css/mediapipe-styles.css">
    <script src="mediapipe-pose/js/mediapipe-pose.js"></script>
</head>
<body>
    <!-- Side Navigation -->
    <div class="side-nav">
        <div class="side-nav-content">
            <div class="side-nav-header">
                <div class="logo-container">
                    <h2 class="logo-text">Stitch House</h2>
                </div>
                <button class="close-sidenav">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="side-nav-links">
                <ul>
                    <li><a href="index.html"><i class="fas fa-home"></i>Home</a></li>
                    <li><a href="order.html"><i class="fas fa-shopping-bag"></i>Shop Now</a></li>
                    <li><a href="myorder.html" class="active"><i class="fas fa-shopping-cart"></i>My Order</a></li>
                    <li><a href="contact.html"><i class="fas fa-envelope"></i>Contact Us</a></li>
                </ul>
            </div>
            <div class="side-nav-footer">
                <div class="social-icons">
                    <a href="#" class="facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="pinterest"><i class="fab fa-pinterest"></i></a>
                    <a href="#" class="youtube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
    </div>
    <div class="side-nav-backdrop"></div>

    <header>
        <div class="container">
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <div class="site-title">
                <a href="index.html">
                    <h1 class="logo-text">Stitch House</h1>
                </a>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="order.html" class="nav-link">Shop Now</a></li>
                    <li><a href="myorder.html" class="nav-link active">My Order</a></li>
                    <li><a href="contact.html" class="nav-link">Contact Us</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <div class="login-link" id="login-link">
                    <a href="login.html">
                        <i class="fas fa-user"></i>
                    </a>
                </div>
                <div class="myorder-link">
                    <a href="myorder.html" title="My Order">
                        <i class="fas fa-cut"></i>
                        <span class="myorder-count">0</span>
                    </a>
                </div>
                <div class="cart-link">
                    <a href="cart.html" title="Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </a>
                </div>
                <div class="user-dropdown" id="user-dropdown" style="display: none;">
                    <button class="user-dropdown-btn" onclick="toggleUserDropdown()">
                        <i class="fas fa-user-circle"></i>
                        <span class="user-name"></span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </button>
                    <div class="user-dropdown-content">
                        <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                        <a href="#" onclick="handleLogout(); return false;"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Page Banner -->
    <section class="page-banner">
        <div class="container">
            <h1>My Order</h1>
            <div class="breadcrumb">
                <a href="index.html">Home</a> / <a href="order.html">Shop</a> / <span>My Order</span>
            </div>
        </div>
    </section>

    <!-- My Order Section -->
    <section class="my-order-section">
        <div class="container">
            <div class="order-container">
                <div class="empty-cart-message" style="display: none;">
                    <i class="fas fa-shopping-cart"></i>
                    <h2>Your order is empty</h2>
                    <p>Browse our collection and add some fabrics to customize</p>
                    <a href="order.html" class="btn-primary">Shop Now</a>
                </div>

                <div class="order-content">
                    <div class="order-items">
                        <h2>Order Items - Customize Your Fabrics</h2>
                        <div class="cart-items-container">
                            <!-- Cart items will be loaded here dynamically -->
                        </div>

                        <div class="cart-actions">
                            <a href="cart.html" class="btn-view-cart">View Final Cart</a>
                            <button class="btn-clear-cart">Clear All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Measurement Options Modal -->
    <div id="measurement-options-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="close-modal">&times;</button>
            <h3 style="text-align: center; margin-bottom: 25px;">
                <i class="fas fa-ruler-combined" style="color: #d4af37;"></i> Choose Measurement Method
            </h3>
            <input type="hidden" id="options-measurement-index" value="">

            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button id="webcam-measurement-option" class="measurement-option-btn" style="
                    background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
                    color: white;
                    border: none;
                    padding: 20px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-size: 16px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
                ">
                    <i class="fas fa-camera" style="font-size: 28px;"></i>
                    <div style="text-align: left;">
                        <strong style="display: block; font-size: 18px;">AI Webcam Measurement</strong>
                        <span style="font-size: 13px; opacity: 0.9;">Auto-detect measurements using your camera</span>
                    </div>
                </button>

                <button id="manual-measurement-option" class="measurement-option-btn" style="
                    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
                    color: white;
                    border: none;
                    padding: 20px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-size: 16px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    transition: all 0.3s ease;
                ">
                    <i class="fas fa-edit" style="font-size: 28px;"></i>
                    <div style="text-align: left;">
                        <strong style="display: block; font-size: 18px;">Manual Entry</strong>
                        <span style="font-size: 13px; opacity: 0.9;">Enter measurements yourself</span>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Manual Measurement Modal -->
    <div id="measurement-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h3><i class="fas fa-ruler"></i> Enter Your Measurements</h3>
            <input type="hidden" id="measurement-item-index" value="">

            <div class="measurement-grid">
                <div class="measurement-field">
                    <label for="m-chest"><i class="fas fa-expand-arrows-alt"></i> Chest (inches)</label>
                    <input type="number" id="m-chest" step="0.1" placeholder="e.g. 40">
                    <small>Measure around fullest part</small>
                </div>
                <div class="measurement-field">
                    <label for="m-waist"><i class="fas fa-expand-arrows-alt"></i> Waist (inches)</label>
                    <input type="number" id="m-waist" step="0.1" placeholder="e.g. 32">
                    <small>Measure at natural waistline</small>
                </div>
                <div class="measurement-field">
                    <label for="m-hip"><i class="fas fa-expand-arrows-alt"></i> Hip (inches)</label>
                    <input type="number" id="m-hip" step="0.1" placeholder="e.g. 38">
                    <small>Measure around fullest part</small>
                </div>
                <div class="measurement-field">
                    <label for="m-shoulder"><i class="fas fa-arrows-alt-h"></i> Shoulder (inches)</label>
                    <input type="number" id="m-shoulder" step="0.1" placeholder="e.g. 18">
                    <small>Shoulder to shoulder</small>
                </div>
                <div class="measurement-field">
                    <label for="m-sleeve"><i class="fas fa-ruler-vertical"></i> Sleeve Length (inches)</label>
                    <input type="number" id="m-sleeve" step="0.1" placeholder="e.g. 24">
                    <small>Shoulder to wrist</small>
                </div>
                <div class="measurement-field">
                    <label for="m-kameez"><i class="fas fa-ruler-vertical"></i> Kameez Length (inches)</label>
                    <input type="number" id="m-kameez" step="0.1" placeholder="e.g. 42">
                    <small>Shoulder to desired length</small>
                </div>
                <div class="measurement-field">
                    <label for="m-trouser"><i class="fas fa-ruler-vertical"></i> Trouser Length (inches)</label>
                    <input type="number" id="m-trouser" step="0.1" placeholder="e.g. 40">
                    <small>Waist to ankle</small>
                </div>
                <div class="measurement-field">
                    <label for="m-neck"><i class="fas fa-circle"></i> Neck (inches)</label>
                    <input type="number" id="m-neck" step="0.1" placeholder="e.g. 15">
                    <small>Around neck</small>
                </div>
            </div>

            <div class="measurement-field" style="margin-top: 15px;">
                <label for="m-notes"><i class="fas fa-sticky-note"></i> Additional Notes</label>
                <textarea id="m-notes" rows="2" placeholder="Any special instructions..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
            </div>

            <button class="btn-save-measurements" onclick="saveMeasurements()">
                <i class="fas fa-check"></i> Save Measurements
            </button>
        </div>
    </div>

    <!-- Webcam Measurement Modal -->
    <div id="webcam-measurement-modal" class="modal" style="z-index: 1002;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <button class="close-modal" id="close-webcam-modal">&times;</button>
            <h3 style="text-align: center; color: #333;">
                <i class="fas fa-camera" style="color: #d4af37;"></i> AI Body Measurement
            </h3>
            <input type="hidden" id="webcam-measurement-item-index" value="">

            <!-- Height Calibration -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #d4af37;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">
                    <i class="fas fa-ruler-vertical" style="color: #d4af37;"></i> Enter Your Height (for calibration)
                </label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="height-feet" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="4">4 ft</option>
                        <option value="5" selected>5 ft</option>
                        <option value="6">6 ft</option>
                        <option value="7">7 ft</option>
                    </select>
                    <select id="height-inches" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="0">0 in</option>
                        <option value="1">1 in</option>
                        <option value="2">2 in</option>
                        <option value="3">3 in</option>
                        <option value="4">4 in</option>
                        <option value="5">5 in</option>
                        <option value="6" selected>6 in</option>
                        <option value="7">7 in</option>
                        <option value="8">8 in</option>
                        <option value="9">9 in</option>
                        <option value="10">10 in</option>
                        <option value="11">11 in</option>
                    </select>
                    <button id="set-height-btn" style="padding: 10px 20px; background: #d4af37; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        Set Height
                    </button>
                </div>
            </div>

            <!-- Camera Section -->
            <div class="camera-section" style="position: relative; width: 100%; max-width: 640px; margin: 0 auto 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.2); background: #000;">
                <video id="webcam-video" width="640" height="480" autoplay muted playsinline style="width: 100%; height: auto; display: block;"></video>
            </div>

            <!-- Status Indicators -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div style="background: #fff3cd; padding: 12px; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <strong style="display: block; margin-bottom: 5px; font-size: 12px; color: #856404;">
                        <i class="fas fa-user"></i> POSE STATUS
                    </strong>
                    <span id="pose-indicator" style="font-size: 13px; color: #856404;">Click Start Camera to begin</span>
                </div>
                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #6c757d;">
                    <strong style="display: block; margin-bottom: 5px; font-size: 12px; color: #495057;">
                        <i class="fas fa-arrows-alt-v"></i> DISTANCE
                    </strong>
                    <div style="background: #e9ecef; border-radius: 4px; height: 8px; margin-top: 5px; overflow: hidden;">
                        <div id="distance-fill" style="height: 100%; width: 0%; background: #28a745; transition: width 0.3s;"></div>
                    </div>
                    <span id="distance-text" style="font-size: 11px; color: #666;">Waiting...</span>
                </div>
            </div>

            <!-- Controls -->
            <div class="webcam-controls" style="text-align: center; margin: 20px 0;">
                <button id="start-camera-btn" class="webcam-btn" style="
                    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                    color: white;
                    border: none;
                    padding: 14px 28px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 15px;
                    font-weight: 600;
                    margin: 5px;
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.3s;
                ">
                    <i class="fas fa-camera"></i> Start Camera
                </button>

                <button id="stop-camera-btn" class="webcam-btn" style="
                    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                    color: white;
                    border: none;
                    padding: 14px 28px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 15px;
                    font-weight: 600;
                    margin: 5px;
                    display: none;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.3s;
                ">
                    <i class="fas fa-stop"></i> Stop Camera
                </button>

                <button id="capture-measurement-btn" class="webcam-btn" style="
                    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
                    color: white;
                    border: none;
                    padding: 14px 28px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 15px;
                    font-weight: 600;
                    margin: 5px;
                    display: none;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.3s;
                " disabled>
                    <i class="fas fa-check"></i> Capture Measurements
                </button>

                <button id="retake-measurement-btn" class="webcam-btn" style="
                    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
                    color: white;
                    border: none;
                    padding: 14px 28px;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 15px;
                    font-weight: 600;
                    margin: 5px;
                    display: none;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.3s;
                ">
                    <i class="fas fa-redo"></i> Retake
                </button>
            </div>

            <!-- Measurement Results -->
            <div id="webcam-results" style="display: none; margin-top: 20px; background: #d4edda; padding: 20px; border-radius: 10px; border: 1px solid #c3e6cb;">
                <h4 style="color: #155724; text-align: center; margin-bottom: 15px;">
                    <i class="fas fa-check-circle"></i> AI Measurements Detected
                </h4>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <div class="webcam-result-field">
                        <label style="font-size: 11px; color: #666; display: block;">Shoulder</label>
                        <input type="number" id="webcam-shoulder" readonly style="width: 100%; padding: 8px; border: 1px solid #28a745; border-radius: 4px; background: white;">
                    </div>
                    <div class="webcam-result-field">
                        <label style="font-size: 11px; color: #666; display: block;">Chest</label>
                        <input type="number" id="webcam-chest" readonly style="width: 100%; padding: 8px; border: 1px solid #28a745; border-radius: 4px; background: white;">
                    </div>
                    <div class="webcam-result-field">
                        <label style="font-size: 11px; color: #666; display: block;">Waist</label>
                        <input type="number" id="webcam-waist" readonly style="width: 100%; padding: 8px; border: 1px solid #28a745; border-radius: 4px; background: white;">
                    </div>
                    <div class="webcam-result-field">
                        <label style="font-size: 11px; color: #666; display: block;">Hip</label>
                        <input type="number" id="webcam-hip" readonly style="width: 100%; padding: 8px; border: 1px solid #28a745; border-radius: 4px; background: white;">
                    </div>
                    <div class="webcam-result-field">
                        <label style="font-size: 11px; color: #666; display: block;">Sleeve Length</label>
                        <input type="number" id="webcam-sleeve_length" readonly style="width: 100%; padding: 8px; border: 1px solid #28a745; border-radius: 4px; background: white;">
                    </div>
                    <div class="webcam-result-field">
                        <label style="font-size: 11px; color: #666; display: block;">Kameez Length</label>
                        <input type="number" id="webcam-kameez_length" readonly style="width: 100%; padding: 8px; border: 1px solid #28a745; border-radius: 4px; background: white;">
                    </div>
                    <div class="webcam-result-field">
                        <label style="font-size: 11px; color: #666; display: block;">Trouser Length</label>
                        <input type="number" id="webcam-trouser_length" readonly style="width: 100%; padding: 8px; border: 1px solid #28a745; border-radius: 4px; background: white;">
                    </div>
                    <div class="webcam-result-field">
                        <label style="font-size: 11px; color: #666; display: block;">Neck</label>
                        <input type="number" id="webcam-neck" readonly style="width: 100%; padding: 8px; border: 1px solid #28a745; border-radius: 4px; background: white;">
                    </div>
                </div>

                <button id="save-webcam-measurements-btn" style="
                    width: 100%;
                    margin-top: 20px;
                    padding: 14px;
                    background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    transition: all 0.3s;
                ">
                    <i class="fas fa-save"></i> Save AI Measurements
                </button>
            </div>

            <!-- Instructions -->
            <div style="margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 8px;">
                <h5 style="margin: 0 0 10px 0; color: #495057;"><i class="fas fa-info-circle"></i> Instructions</h5>
                <ol style="margin: 0; padding-left: 20px; color: #666; font-size: 13px; line-height: 1.8;">
                    <li>Enter your height and click "Set Height"</li>
                    <li>Click "Start Camera" and allow camera access</li>
                    <li>Stand 5-6 feet away, facing the camera</li>
                    <li>Keep your full body visible (head to feet)</li>
                    <li>Wait for calibration to complete</li>
                    <li>Click "Capture Measurements" when ready</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Order History Modal -->
    <div id="order-history-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h3><i class="fas fa-history"></i> Your Order History</h3>
            <div id="order-history-content">
                <!-- Order history will be loaded here -->
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section about">
                    <div class="footer-logo">
                        <a href="index.html" class="logo-button">
                            <h3 class="logo-text">Stitch House</h3>
                        </a>
                    </div>
                    <p>Your premium destination for high-quality fabrics and exceptional service.</p>
                    <div class="social-icons">
                        <a href="#" class="facebook"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="pinterest"><i class="fab fa-pinterest"></i></a>
                        <a href="#" class="youtube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-section links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="order.html">Shop Now</a></li>
                        <li><a href="myorder.html">My Order</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section contact">
                    <h3>Contact Info</h3>
                    <p><i class="fas fa-map-marker-alt"></i> Main Gulberg, Lahore, Pakistan</p>
                    <p><i class="fas fa-phone"></i> 0304-2292813</p>
                    <p><i class="fas fa-envelope"></i> info@stitchhouse.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Stitch House. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <div class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
    // Global cart variable
    let cart = [];

    document.addEventListener('DOMContentLoaded', function() {
        // Side navigation functionality
        const sideNavToggle = document.querySelector('.menu-toggle');
        const sideNav = document.querySelector('.side-nav');
        const sideNavBackdrop = document.querySelector('.side-nav-backdrop');
        const sideNavClose = document.querySelector('.close-sidenav');

        if (sideNavToggle && sideNav) {
            sideNavToggle.addEventListener('click', () => {
                sideNav.classList.add('open');
                sideNavBackdrop.classList.add('active');
                document.body.classList.add('no-scroll');
            });
        }

        function closeSideNav() {
            if (sideNav) {
                sideNav.classList.remove('open');
                sideNavBackdrop.classList.remove('active');
                document.body.classList.remove('no-scroll');
            }
        }

        if (sideNavClose) sideNavClose.addEventListener('click', closeSideNav);
        if (sideNavBackdrop) sideNavBackdrop.addEventListener('click', closeSideNav);

        // Back to top button
        const backToTopBtn = document.querySelector('.back-to-top');
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Close modals
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
            });
        });

        // Close modal on backdrop click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.remove('active');
            });
        });

        // Check login status
        checkLoginStatus();

        // Load cart from localStorage
        cart = JSON.parse(localStorage.getItem('shoppingCart')) || [];
        displayCart();

        // Clear cart button
        document.querySelector('.btn-clear-cart').addEventListener('click', () => {
            if (cart.length > 0 && confirm('Are you sure you want to clear all items?')) {
                cart = [];
                saveAndUpdateCart();
            }
        });
    });

    function checkLoginStatus() {
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        const userName = localStorage.getItem('userName');
        const loginLink = document.getElementById('login-link');
        const userDropdown = document.getElementById('user-dropdown');

        if (isLoggedIn && userName) {
            if (loginLink) loginLink.style.display = 'none';
            if (userDropdown) {
                userDropdown.style.display = 'block';
                userDropdown.querySelector('.user-name').textContent = userName;
            }
        } else {
            if (loginLink) loginLink.style.display = 'block';
            if (userDropdown) userDropdown.style.display = 'none';
        }
    }

    function toggleUserDropdown() {
        const dropdown = document.getElementById('user-dropdown');
        dropdown.classList.toggle('active');
    }

    document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('user-dropdown');
        if (dropdown && !dropdown.contains(e.target)) {
            dropdown.classList.remove('active');
        }
    });

    function handleLogout() {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('userName');
        localStorage.removeItem('userEmail');
        localStorage.removeItem('userPhone');
        localStorage.removeItem('shoppingCart');
        localStorage.removeItem('finalCart');
        window.location.href = 'index.html';
    }

    function showOrderHistory() {
        const orders = JSON.parse(localStorage.getItem('orders')) || [];
        const container = document.getElementById('order-history-content');

        if (orders.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #666;">No orders found.</p>';
        } else {
            let html = '';
            orders.reverse().forEach((order, i) => {
                html += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <strong>Order #${order.orderNumber}</strong>
                            <span style="color: #666; font-size: 12px;">${new Date(order.date).toLocaleDateString()}</span>
                        </div>
                        <p style="margin: 5px 0; font-size: 14px;">Items: ${order.items.length}</p>
                        <p style="margin: 5px 0; font-size: 14px; color: #28a745;">Status: Confirmed</p>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        document.getElementById('order-history-modal').classList.add('active');
    }

    function displayCart() {
        const cartItemsContainer = document.querySelector('.cart-items-container');
        const emptyCartMessage = document.querySelector('.empty-cart-message');
        const orderContent = document.querySelector('.order-content');

        updateCartCount();

        if (cart.length === 0) {
            emptyCartMessage.style.display = 'flex';
            orderContent.style.display = 'none';
            return;
        }

        emptyCartMessage.style.display = 'none';
        orderContent.style.display = 'flex';
        cartItemsContainer.innerHTML = '';

        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            const hasDesign = item.design ? true : false;
            const hasMeasurements = item.hasMeasurements ? true : false;
            const canAddToCart = hasDesign && hasMeasurements;

            const cartItemEl = document.createElement('div');
            cartItemEl.classList.add('cart-item');
            cartItemEl.innerHTML = `
                <div class="cart-item-image">
                    <img src="images/${item.image}" alt="${item.name}" onerror="this.src='images/placeholder.jpg'">
                </div>
                <div class="cart-item-details">
                    <h3>${item.name}</h3>
                    <p class="price">PKR. ${item.price.toLocaleString()}</p>
                    ${item.design ? `
                        <div style="background: linear-gradient(90deg, #d4edda, #f8fff8); padding: 8px 12px; border-radius: 5px; border-left: 3px solid #28a745; margin: 8px 0;">
                            <span style="color: #28a745; font-size: 13px;"><i class="fas fa-check-circle"></i> ${item.design}</span>
                        </div>
                    ` : ''}
                    ${item.hasMeasurements ? `
                        <div style="background: linear-gradient(90deg, #e8f5e9, #f1f8f1); padding: 10px 12px; border-radius: 5px; border-left: 3px solid #4caf50; margin: 8px 0; display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #2e7d32; font-size: 13px;">
                                <i class="fas fa-ruler"></i> <strong>Measurements Saved</strong>
                                ${item.measurements ? `<span style="font-size: 11px; color: #666; margin-left: 8px;">(${item.measurements.notes === 'AI Webcam Measurement' ? 'AI Webcam' : 'Manual'})</span>` : ''}
                            </span>
                            <button onclick="openMeasurementModal(${index})" style="background: none; border: 1px solid #d4af37; color: #d4af37; cursor: pointer; font-size: 12px; padding: 4px 10px; border-radius: 4px; transition: all 0.3s;">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                    ` : ''}
                    <div class="design-btn-group">
                        <button class="customize-item-btn" onclick="toggleDesignPanel(${index})">
                            <i class="fas fa-tshirt"></i> ${item.design ? 'Edit Design' : 'Customize Design'}
                        </button>
                        <button class="measurement-btn" onclick="openMeasurementModal(${index})">
                            <i class="fas fa-ruler"></i> ${item.hasMeasurements ? 'Edit' : 'Add'} Measurements
                        </button>
                    </div>
                </div>
                <div class="cart-item-quantity">
                    <button class="quantity-btn decrease" onclick="updateQuantity(${index}, -1)">-</button>
                    <span class="quantity">${item.quantity}</span>
                    <button class="quantity-btn increase" onclick="updateQuantity(${index}, 1)">+</button>
                </div>
                <div class="cart-item-total">
                    <p>PKR. ${itemTotal.toLocaleString()}</p>
                    <button class="add-to-cart-btn ${canAddToCart ? '' : 'disabled'}" onclick="addToFinalCart(${index})" ${canAddToCart ? '' : 'disabled'}>
                        <i class="fas fa-cart-plus"></i> Add to Cart
                    </button>
                </div>
                <button class="remove-item" onclick="removeItem(${index})">
                    <i class="fas fa-trash"></i>
                </button>
                <div class="item-design-container" id="design-container-${index}"></div>
            `;

            cartItemsContainer.appendChild(cartItemEl);
        });
    }

    function updateQuantity(index, change) {
        if (cart[index].quantity + change >= 1) {
            cart[index].quantity += change;
            saveAndUpdateCart();
        }
    }

    function removeItem(index) {
        cart.splice(index, 1);
        saveAndUpdateCart();
    }

    function toggleDesignPanel(index) {
        const container = document.getElementById(`design-container-${index}`);

        if (container.innerHTML !== '') {
            container.innerHTML = '';
            return;
        }

        const item = cart[index];
        const designOptions = item.designOptions || {};

        container.innerHTML = `
            <div class="item-design-options">
                <div class="design-header">
                    <h4>Customize Your Design</h4>
                    <button class="close-design-btn" onclick="document.getElementById('design-container-${index}').innerHTML=''"><i class="fas fa-times"></i></button>
                </div>

                <div class="design-section">
                    <h5>Collar Style</h5>
                    <div class="design-options">
                        <div class="design-option">
                            <input type="radio" id="collar-band-${index}" name="collar-${index}" value="Band Collar" ${designOptions.collar === 'Band Collar' ? 'checked' : ''}>
                            <label for="collar-band-${index}">Band Collar</label>
                        </div>
                        <div class="design-option">
                            <input type="radio" id="collar-straight-${index}" name="collar-${index}" value="Straight Collar" ${designOptions.collar === 'Straight Collar' ? 'checked' : ''}>
                            <label for="collar-straight-${index}">Straight Collar</label>
                        </div>
                    </div>
                </div>

                <div class="design-section">
                    <h5>Kameez Style</h5>
                    <div class="design-options">
                        <div class="design-option">
                            <input type="radio" id="kurta-${index}" name="kurta-${index}" value="Kurta Style" ${designOptions.kurta === 'Kurta Style' ? 'checked' : ''}>
                            <label for="kurta-${index}">Kurta Style</label>
                        </div>
                        <div class="design-option">
                            <input type="radio" id="simple-${index}" name="kurta-${index}" value="Simple Kameez" ${designOptions.kurta === 'Simple Kameez' ? 'checked' : ''}>
                            <label for="simple-${index}">Simple Kameez</label>
                        </div>
                    </div>
                </div>

                <div class="design-section">
                    <h5>Bottom Style</h5>
                    <div class="design-options">
                        <div class="design-option">
                            <input type="radio" id="shalwar-${index}" name="bottom-${index}" value="Shalwar" ${designOptions.bottom === 'Shalwar' ? 'checked' : ''}>
                            <label for="shalwar-${index}">Shalwar</label>
                        </div>
                        <div class="design-option">
                            <input type="radio" id="trouser-${index}" name="bottom-${index}" value="Trouser" ${designOptions.bottom === 'Trouser' ? 'checked' : ''}>
                            <label for="trouser-${index}">Trouser</label>
                        </div>
                    </div>
                </div>

                <div class="design-section">
                    <h5>Front Pocket</h5>
                    <div class="design-options">
                        <div class="design-option">
                            <input type="radio" id="fp-yes-${index}" name="fp-${index}" value="With Front Pocket" ${designOptions.frontPocket === 'With Front Pocket' ? 'checked' : ''}>
                            <label for="fp-yes-${index}">With Pocket</label>
                        </div>
                        <div class="design-option">
                            <input type="radio" id="fp-no-${index}" name="fp-${index}" value="No Front Pocket" ${designOptions.frontPocket === 'No Front Pocket' ? 'checked' : ''}>
                            <label for="fp-no-${index}">No Pocket</label>
                        </div>
                    </div>
                </div>

                <div class="design-section">
                    <h5>Side Pockets</h5>
                    <div class="design-options">
                        <div class="design-option">
                            <input type="radio" id="sp-two-${index}" name="sp-${index}" value="Two Side Pockets" ${designOptions.sidePocket === 'Two Side Pockets' ? 'checked' : ''}>
                            <label for="sp-two-${index}">Two Pockets</label>
                        </div>
                        <div class="design-option">
                            <input type="radio" id="sp-one-${index}" name="sp-${index}" value="One Side Pocket" ${designOptions.sidePocket === 'One Side Pocket' ? 'checked' : ''}>
                            <label for="sp-one-${index}">One Pocket</label>
                        </div>
                        <div class="design-option">
                            <input type="radio" id="sp-none-${index}" name="sp-${index}" value="No Side Pockets" ${designOptions.sidePocket === 'No Side Pockets' ? 'checked' : ''}>
                            <label for="sp-none-${index}">No Pockets</label>
                        </div>
                    </div>
                </div>

                <button class="btn-confirm-design" onclick="confirmDesign(${index})">Confirm Design</button>
            </div>
        `;
    }

    function confirmDesign(index) {
        const collar = document.querySelector(`input[name="collar-${index}"]:checked`);
        const kurta = document.querySelector(`input[name="kurta-${index}"]:checked`);
        const bottom = document.querySelector(`input[name="bottom-${index}"]:checked`);
        const frontPocket = document.querySelector(`input[name="fp-${index}"]:checked`);
        const sidePocket = document.querySelector(`input[name="sp-${index}"]:checked`);

        if (!collar || !kurta || !bottom || !frontPocket || !sidePocket) {
            alert('Please select all design options');
            return;
        }

        const designDescription = `${kurta.value} with ${collar.value}, ${bottom.value}, ${frontPocket.value}, ${sidePocket.value}`;

        cart[index].design = designDescription;
        cart[index].designOptions = {
            collar: collar.value,
            kurta: kurta.value,
            bottom: bottom.value,
            frontPocket: frontPocket.value,
            sidePocket: sidePocket.value
        };

        saveAndUpdateCart();
        showToast('Design saved successfully!');
    }

    function openMeasurementModal(index) {
        // Store the index for later use
        document.getElementById('options-measurement-index').value = index;
        // Show measurement options modal first (AI Webcam or Manual)
        document.getElementById('measurement-options-modal').classList.add('active');
    }

    function openManualMeasurementModal(index) {
        document.getElementById('measurement-item-index').value = index;

        // Pre-fill existing measurements
        const item = cart[index];
        if (item.measurements) {
            document.getElementById('m-chest').value = item.measurements.chest || '';
            document.getElementById('m-waist').value = item.measurements.waist || '';
            document.getElementById('m-hip').value = item.measurements.hip || '';
            document.getElementById('m-shoulder').value = item.measurements.shoulder || '';
            document.getElementById('m-sleeve').value = item.measurements.sleeve || '';
            document.getElementById('m-kameez').value = item.measurements.kameez || '';
            document.getElementById('m-trouser').value = item.measurements.trouser || '';
            document.getElementById('m-neck').value = item.measurements.neck || '';
            document.getElementById('m-notes').value = item.measurements.notes || '';
        } else {
            // Clear all fields
            ['m-chest', 'm-waist', 'm-hip', 'm-shoulder', 'm-sleeve', 'm-kameez', 'm-trouser', 'm-neck', 'm-notes'].forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        document.getElementById('measurement-modal').classList.add('active');
    }

    function saveMeasurements() {
        const index = parseInt(document.getElementById('measurement-item-index').value);

        const chest = document.getElementById('m-chest').value;
        const waist = document.getElementById('m-waist').value;
        const hip = document.getElementById('m-hip').value;

        // Require at least 3 measurements
        let filledCount = 0;
        ['m-chest', 'm-waist', 'm-hip', 'm-shoulder', 'm-sleeve', 'm-kameez', 'm-trouser', 'm-neck'].forEach(id => {
            if (document.getElementById(id).value) filledCount++;
        });

        if (filledCount < 3) {
            alert('Please enter at least 3 measurements');
            return;
        }

        cart[index].measurements = {
            chest: document.getElementById('m-chest').value,
            waist: document.getElementById('m-waist').value,
            hip: document.getElementById('m-hip').value,
            shoulder: document.getElementById('m-shoulder').value,
            sleeve: document.getElementById('m-sleeve').value,
            kameez: document.getElementById('m-kameez').value,
            trouser: document.getElementById('m-trouser').value,
            neck: document.getElementById('m-neck').value,
            notes: document.getElementById('m-notes').value
        };
        cart[index].hasMeasurements = true;

        saveAndUpdateCart();
        document.getElementById('measurement-modal').classList.remove('active');
        showToast('Measurements saved successfully!');
    }

    function addToFinalCart(index) {
        const item = cart[index];

        if (!item.design || !item.hasMeasurements) {
            alert('Please complete both design and measurements before adding to cart.');
            return;
        }

        // Get or create final cart
        let finalCart = JSON.parse(localStorage.getItem('finalCart')) || [];

        // Check if item already exists in final cart
        const existingIndex = finalCart.findIndex(ci => ci.id === item.id && ci.design === item.design);

        if (existingIndex >= 0) {
            finalCart[existingIndex].quantity += item.quantity;
        } else {
            finalCart.push({...item});
        }

        // Save final cart
        localStorage.setItem('finalCart', JSON.stringify(finalCart));

        // Remove from shopping cart
        cart.splice(index, 1);
        saveAndUpdateCart();

        showToast(`${item.name} added to cart!`);
    }

    function saveAndUpdateCart() {
        localStorage.setItem('shoppingCart', JSON.stringify(cart));
        displayCart();
    }

    function updateCartCount() {
        const cartCountEl = document.querySelector('.cart-count');
        const myorderCountEl = document.querySelector('.myorder-count');
        const shoppingCart = JSON.parse(localStorage.getItem('shoppingCart')) || [];
        const finalCart = JSON.parse(localStorage.getItem('finalCart')) || [];

        // My Order count - items waiting for customization
        let myOrderTotal = 0;
        shoppingCart.forEach(item => myOrderTotal += item.quantity || 1);
        if (myorderCountEl) myorderCountEl.textContent = myOrderTotal;

        // Cart count - only customized items ready for checkout
        let cartTotal = 0;
        finalCart.forEach(item => cartTotal += item.quantity || 1);
        if (cartCountEl) cartCountEl.textContent = cartTotal;
    }

    function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    // ===== MediaPipe Webcam Measurement Functionality =====
    let mediaPipeMeasurement = null;
    let userHeightInches = 66; // Default 5'6"

    // Initialize MediaPipe event listeners
    document.addEventListener('DOMContentLoaded', function() {
        // Webcam measurement option click
        document.getElementById('webcam-measurement-option').addEventListener('click', function() {
            const index = document.getElementById('options-measurement-index').value;
            document.getElementById('webcam-measurement-item-index').value = index;
            document.getElementById('measurement-options-modal').classList.remove('active');
            document.getElementById('webcam-measurement-modal').classList.add('active');

            // Reset webcam modal state
            resetWebcamModal();
        });

        // Manual measurement option click
        document.getElementById('manual-measurement-option').addEventListener('click', function() {
            const index = document.getElementById('options-measurement-index').value;
            document.getElementById('measurement-options-modal').classList.remove('active');
            openManualMeasurementModal(parseInt(index));
        });

        // Set height button
        document.getElementById('set-height-btn').addEventListener('click', function() {
            const feet = parseInt(document.getElementById('height-feet').value);
            const inches = parseInt(document.getElementById('height-inches').value);
            userHeightInches = (feet * 12) + inches;

            if (mediaPipeMeasurement) {
                mediaPipeMeasurement.setUserHeight(userHeightInches);
            }

            showToast(`Height set to ${feet}' ${inches}"`);
        });

        // Start camera button
        document.getElementById('start-camera-btn').addEventListener('click', async function() {
            try {
                // Initialize MediaPipe if not already done
                if (!mediaPipeMeasurement) {
                    mediaPipeMeasurement = new MediaPipeMeasurement();
                    mediaPipeMeasurement.setUserHeight(userHeightInches);
                    await mediaPipeMeasurement.initialize();
                }

                // Start camera with video element ID
                await mediaPipeMeasurement.startCamera('webcam-video');

                // Update button visibility
                document.getElementById('start-camera-btn').style.display = 'none';
                document.getElementById('stop-camera-btn').style.display = 'inline-flex';
                document.getElementById('capture-measurement-btn').style.display = 'inline-flex';

            } catch (error) {
                console.error('Camera error:', error);
                showToast('Error accessing camera. Please check permissions.');
            }
        });

        // Stop camera button
        document.getElementById('stop-camera-btn').addEventListener('click', function() {
            if (mediaPipeMeasurement) {
                mediaPipeMeasurement.stopCamera();
            }

            document.getElementById('start-camera-btn').style.display = 'inline-flex';
            document.getElementById('stop-camera-btn').style.display = 'none';
            document.getElementById('capture-measurement-btn').style.display = 'none';
            document.getElementById('pose-indicator').textContent = 'Camera stopped';
        });

        // Capture measurement button
        document.getElementById('capture-measurement-btn').addEventListener('click', function() {
            if (mediaPipeMeasurement && mediaPipeMeasurement.isCalibrated) {
                const measurements = mediaPipeMeasurement.getSimpleMeasurements();

                if (Object.keys(measurements).length > 0) {
                    displayWebcamMeasurements(measurements);

                    // Stop camera after capture
                    mediaPipeMeasurement.stopCamera();

                    // Update buttons
                    document.getElementById('start-camera-btn').style.display = 'none';
                    document.getElementById('stop-camera-btn').style.display = 'none';
                    document.getElementById('capture-measurement-btn').style.display = 'none';
                    document.getElementById('retake-measurement-btn').style.display = 'inline-flex';

                    // Show results
                    document.getElementById('webcam-results').style.display = 'block';
                } else {
                    showToast('No measurements detected yet. Please wait for calibration.');
                }
            } else {
                showToast('Please wait for calibration to complete');
            }
        });

        // Retake measurement button
        document.getElementById('retake-measurement-btn').addEventListener('click', async function() {
            document.getElementById('webcam-results').style.display = 'none';
            document.getElementById('retake-measurement-btn').style.display = 'none';
            document.getElementById('start-camera-btn').style.display = 'inline-flex';

            // Reset MediaPipe for new measurement
            if (mediaPipeMeasurement) {
                mediaPipeMeasurement = null;
            }
        });

        // Save webcam measurements button
        document.getElementById('save-webcam-measurements-btn').addEventListener('click', function() {
            saveWebcamMeasurements();
        });

        // Close webcam modal - stop camera
        document.getElementById('close-webcam-modal').addEventListener('click', function() {
            if (mediaPipeMeasurement) {
                mediaPipeMeasurement.stopCamera();
                mediaPipeMeasurement = null;
            }
            document.getElementById('webcam-measurement-modal').classList.remove('active');
            resetWebcamModal();
        });
    });

    function displayWebcamMeasurements(measurements) {
        document.getElementById('webcam-shoulder').value = measurements.shoulder || '';
        document.getElementById('webcam-chest').value = measurements.chest || '';
        document.getElementById('webcam-waist').value = measurements.waist || '';
        document.getElementById('webcam-hip').value = measurements.hip || '';
        document.getElementById('webcam-sleeve_length').value = measurements.sleeve_length || '';
        document.getElementById('webcam-kameez_length').value = measurements.kameez_length || '';
        document.getElementById('webcam-trouser_length').value = measurements.trouser_length || '';
        document.getElementById('webcam-neck').value = measurements.neck || '';
    }

    function saveWebcamMeasurements() {
        const index = parseInt(document.getElementById('webcam-measurement-item-index').value);

        if (isNaN(index) || !cart[index]) {
            showToast('Error: Item not found');
            return;
        }

        // Get measurements from webcam results
        const measurements = {
            shoulder: document.getElementById('webcam-shoulder').value,
            chest: document.getElementById('webcam-chest').value,
            waist: document.getElementById('webcam-waist').value,
            hip: document.getElementById('webcam-hip').value,
            sleeve: document.getElementById('webcam-sleeve_length').value,
            kameez: document.getElementById('webcam-kameez_length').value,
            trouser: document.getElementById('webcam-trouser_length').value,
            neck: document.getElementById('webcam-neck').value,
            notes: 'AI Webcam Measurement'
        };

        // Save to cart item
        cart[index].measurements = measurements;
        cart[index].hasMeasurements = true;

        saveAndUpdateCart();

        // Close modal and reset
        document.getElementById('webcam-measurement-modal').classList.remove('active');
        resetWebcamModal();

        showToast('AI Measurements saved successfully!');
    }

    function resetWebcamModal() {
        // Reset buttons
        document.getElementById('start-camera-btn').style.display = 'inline-flex';
        document.getElementById('stop-camera-btn').style.display = 'none';
        document.getElementById('capture-measurement-btn').style.display = 'none';
        document.getElementById('capture-measurement-btn').disabled = true;
        document.getElementById('capture-measurement-btn').style.background = 'linear-gradient(135deg, #6c757d 0%, #5a6268 100%)';
        document.getElementById('retake-measurement-btn').style.display = 'none';

        // Reset results
        document.getElementById('webcam-results').style.display = 'none';

        // Reset status
        document.getElementById('pose-indicator').textContent = 'Click Start Camera to begin';
        document.getElementById('distance-fill').style.width = '0%';
        document.getElementById('distance-text').textContent = 'Waiting...';

        currentWebcamMeasurements = null;
    }
    </script>
</body>
</html>
